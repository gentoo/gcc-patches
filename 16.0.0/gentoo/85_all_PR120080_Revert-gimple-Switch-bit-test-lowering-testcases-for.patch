From 4c57a4d3c280b249649495e032682f5eea41752b Mon Sep 17 00:00:00 2001
Message-ID: <4c57a4d3c280b249649495e032682f5eea41752b.1746450157.git.sam@gentoo.org>
From: Sam James <sam@gentoo.org>
Date: Mon, 5 May 2025 14:02:03 +0100
Subject: [PATCH 1/4] Revert "gimple: Switch bit-test lowering testcases for
 the more powerful alg"

This reverts commit 8444c4cc7648f4396e2a3726677f909438e92c80.
---
 gcc/testsuite/gcc.dg/tree-ssa/switch-5.c | 60 ------------------------
 gcc/testsuite/gcc.dg/tree-ssa/switch-6.c | 51 --------------------
 2 files changed, 111 deletions(-)
 delete mode 100644 gcc/testsuite/gcc.dg/tree-ssa/switch-5.c
 delete mode 100644 gcc/testsuite/gcc.dg/tree-ssa/switch-6.c

diff --git a/gcc/testsuite/gcc.dg/tree-ssa/switch-5.c b/gcc/testsuite/gcc.dg/tree-ssa/switch-5.c
deleted file mode 100644
index b05742cf153c..000000000000
--- a/gcc/testsuite/gcc.dg/tree-ssa/switch-5.c
+++ /dev/null
@@ -1,60 +0,0 @@
-/* { dg-do compile { target { { x86_64-*-* aarch64-*-* ia64-*-* powerpc64-*-* } && lp64 } } } */
-/* { dg-options "-O2 -fdump-tree-switchlower1" } */
-
-int f0();    
-int f1();    
-int f2();    
-int f3();    
-int f4();    
-     
-int foo(int a)    
-{    
-    switch (a)    
-    {    
-        case 0:    
-        case 2:    
-        case 4:    
-        case 6:    
-            return f0();    
-        case 8:    
-            return f1();    
-        case 10:    
-        case 14:    
-        case 16:    
-        case 18:    
-            return f2();    
-        case 12:    
-            return f3();    
-        case 20:    
-            return f4();    
-    }    
-    return -1;    
-}
-
-/* { dg-final { scan-tree-dump ";; GIMPLE switch case clusters: BT:0-8 BT:10-20" "switchlower1" } } */
-
-int bar(int a)    
-{    
-    switch (a)    
-    {    
-        case 20:    
-        case 18:    
-        case 16:    
-        case 14:    
-            return f0();    
-        case 12:    
-            return f1();    
-        case 10:    
-        case 6:    
-        case 4:    
-        case 2:    
-            return f2();    
-        case 8:    
-            return f3();    
-        case 0:    
-            return f4();    
-    }    
-    return -1;    
-}
-
-/* { dg-final { scan-tree-dump ";; GIMPLE switch case clusters: BT:0-10 BT:12-20" "switchlower1" } } */
diff --git a/gcc/testsuite/gcc.dg/tree-ssa/switch-6.c b/gcc/testsuite/gcc.dg/tree-ssa/switch-6.c
deleted file mode 100644
index bbbc87462c40..000000000000
--- a/gcc/testsuite/gcc.dg/tree-ssa/switch-6.c
+++ /dev/null
@@ -1,51 +0,0 @@
-/* { dg-do compile { target { { x86_64-*-* aarch64-*-* ia64-*-* powerpc64-*-* } && lp64 } } } */
-/* { dg-options "-O2 -fdump-tree-switchlower1 -fno-jump-tables" } */
-
-/* Test that bit-test switch lowering can create cluster of size 64 (there was
-   an of-by-one error causing it to only do 63 before).  */
-
-int f();    
-
-int foo(int a)
-{
-    switch (a)
-    {
-        case 0:
-        case 3:
-        case 5:
-        case 7:
-        case 9:
-        case 11:
-        case 13:
-        case 15:
-        case 17:
-        case 19:
-        case 21:
-        case 23:
-        case 25:
-        case 27:
-        case 29:
-        case 31:
-        case 33:
-        case 35:
-        case 37:
-        case 39:
-        case 41:
-        case 43:
-        case 45:
-        case 47:
-        case 49:
-        case 51:
-        case 53:
-        case 55:
-        case 57:
-        case 59:
-        case 61:
-        case 63:
-            return f();
-        default:
-            return -1;
-    }
-}
-
-/* { dg-final { scan-tree-dump ";; GIMPLE switch case clusters: BT:0-63" "switchlower1" } } */
-- 
2.49.0

